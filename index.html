<!DOCTYPE html>
<html lang="tr" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gelişmiş Görev Yöneticisi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Roboto', sans-serif; -webkit-tap-highlight-color: transparent; }
        .smooth-transition { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .soft-shadow { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); }
        .soft-shadow-dark { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25); }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
        @keyframes slideInUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes slideOutDown { from { transform: translateY(0); } to { transform: translateY(100%); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        .modal-bg-in { animation: fadeIn 0.3s ease-out forwards; }
        .modal-bg-out { animation: fadeOut 0.3s ease-in forwards; }
        .modal-content-in { animation: slideInUp 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
        .modal-content-out { animation: slideOutDown 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
        
        .avatar-upload-label { position: relative; cursor: pointer; display: inline-block; }
        .avatar-upload-label .overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            top: 0;
            background-color: rgba(0,0,0,0.4);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.3s ease;
            font-size: 2rem;
        }
        .avatar-upload-label:hover .overlay { opacity: 1; }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: { colors: {
                primary: { light: '#3b82f6', DEFAULT: '#3b82f6', dark: '#60a5fa' },
                accent: { light: '#14b8a6', DEFAULT: '#14b8a6', dark: '#2dd4bf' },
                background: { light: '#f8fafc', dark: '#0f172a' },
                surface: { light: '#ffffff', dark: '#1e293b' },
                on: {
                    background: { light: '#1e293b', dark: '#e2e8f0' },
                    surface: { light: '#0f172a', dark: '#f8fafc' },
                    primary: { light: '#ffffff', dark: '#020617' }
                }
            }}}
        }
    </script>
</head>
<body class="bg-background-light dark:bg-background-dark text-on-background-light dark:text-on-background-dark smooth-transition overflow-hidden">

<div id="app-container" class="max-w-md mx-auto h-screen flex flex-col border-x border-slate-200 dark:border-slate-800 bg-surface-light dark:bg-surface-dark">
    <header class="p-4 flex justify-between items-center sticky top-0 bg-surface-light/80 dark:bg-surface-dark/80 backdrop-blur-sm z-20 border-b border-slate-200 dark:border-slate-800">
        <div id="header-content" class="flex-1 flex items-center"><h1 id="header-title" class="text-2xl font-bold smooth-transition">Bugün</h1><input type="text" id="search-input" placeholder="Görevlerde ara..." class="hidden w-full bg-slate-100 dark:bg-slate-700 rounded-lg px-4 py-1.5 focus:outline-none focus:ring-2 focus:ring-primary-light"></div>
        <div id="header-icons" class="flex items-center space-x-4 pl-4"><button id="search-btn" class="text-slate-500 dark:text-slate-400 text-xl"><i class="fa-solid fa-magnifying-glass"></i></button><button id="filter-btn" class="text-slate-500 dark:text-slate-400 text-xl"><i class="fa-solid fa-filter"></i></button></div>
    </header>

    <main id="main-content" class="flex-1 overflow-y-auto p-4"></main>

    <button id="fab" class="hidden fixed bottom-24 right-1/2 translate-x-[11rem] w-14 h-14 bg-primary-light dark:bg-primary-dark text-on-primary-light dark:text-on-primary-dark rounded-2xl flex items-center justify-center text-2xl soft-shadow dark:soft-shadow-dark smooth-transition hover:scale-105 active:scale-95 z-30"><i class="fa-solid fa-plus"></i></button>

    <nav class="sticky bottom-0 bg-surface-light/80 dark:bg-surface-dark/80 backdrop-blur-sm z-20 border-t border-slate-200 dark:border-slate-800"><div class="flex justify-around items-center h-20"><button data-page="home" class="nav-item active flex flex-col items-center justify-center text-primary-light dark:text-primary-dark w-full h-full"><i class="fa-solid fa-check-double text-xl"></i><span class="text-xs font-medium mt-1">Görevler</span></button><button data-page="calendar" class="nav-item flex flex-col items-center justify-center text-slate-500 dark:text-slate-400 w-full h-full"><i class="fa-solid fa-calendar-days text-xl"></i><span class="text-xs font-medium mt-1">Takvim</span></button><button data-page="settings" class="nav-item flex flex-col items-center justify-center text-slate-500 dark:text-slate-400 w-full h-full"><i class="fa-solid fa-user-gear text-xl"></i><span class="text-xs font-medium mt-1">Ayarlar</span></button></div></nav>
</div>

<div id="add-task-modal" class="fixed inset-0 bg-black/40 dark:bg-black/60 z-50 flex justify-center items-end hidden modal-bg-in">
    <div class="modal-content w-full max-w-md bg-surface-light dark:bg-surface-dark rounded-t-2xl p-6 max-h-[90vh] flex flex-col">
        <h2 class="text-xl font-bold mb-4 flex-shrink-0">Yeni Görev Ekle</h2>
        <form id="add-task-form" class="space-y-4 overflow-y-auto flex-1">
            <input type="text" id="task-title-input" placeholder="Görev Başlığı" required class="w-full bg-slate-100 dark:bg-slate-800 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-primary-light">
            <textarea id="task-description-input" placeholder="Açıklama..." rows="3" class="w-full bg-slate-100 dark:bg-slate-800 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-primary-light"></textarea>
            <div class="grid grid-cols-2 gap-4">
                <input type="date" id="task-date-input" required class="w-full bg-slate-100 dark:bg-slate-800 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-primary-light">
                <input type="time" id="task-time-input" title="Alarm saati ayarla" class="w-full bg-slate-100 dark:bg-slate-800 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-primary-light">
            </div>
            <select id="task-priority-input" class="w-full bg-slate-100 dark:bg-slate-800 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-primary-light"><option value="low">Düşük Öncelik</option><option value="medium">Orta Öncelik</option><option value="high">Yüksek Öncelik</option></select>
            
            <div>
                <label for="task-image-input" class="cursor-pointer w-full flex items-center justify-center space-x-2 bg-slate-100 dark:bg-slate-800 rounded-lg p-3 text-slate-500 dark:text-slate-400">
                    <i class="fa-solid fa-paperclip"></i><span>Resim Ekle</span>
                </label>
                <input type="file" id="task-image-input" accept="image/*" class="hidden">
                <img id="image-preview" src="" alt="Resim Önizleme" class="hidden mt-3 rounded-lg w-full h-auto max-h-40 object-cover"/>
            </div>

            <div class="flex justify-end space-x-3 pt-2 flex-shrink-0">
                <button type="button" class="cancel-btn px-4 py-2 rounded-lg bg-slate-200 dark:bg-slate-700 font-semibold">İptal</button>
                <button type="submit" class="px-4 py-2 rounded-lg bg-primary-light dark:bg-primary-dark text-on-primary-light dark:text-on-primary-dark font-semibold">Görevi Kaydet</button>
            </div>
        </form>
    </div>
</div>
<div id="filter-modal" class="fixed inset-0 bg-black/40 dark:bg-black/60 z-50 flex justify-center items-end hidden modal-bg-in"><div class="modal-content w-full max-w-md bg-surface-light dark:bg-surface-dark rounded-t-2xl p-4"><div class="w-10 h-1.5 bg-slate-300 dark:bg-slate-600 rounded-full mx-auto mb-4"></div><h3 class="text-lg font-bold text-center mb-4">Filtrele</h3><div class="space-y-2"><button data-filter="all" class="filter-option w-full text-left p-3 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 font-medium">Tüm Görevler</button><button data-filter="active" class="filter-option w-full text-left p-3 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 font-medium">Aktif</button><button data-filter="completed" class="filter-option w-full text-left p-3 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 font-medium">Tamamlanmış</button></div></div></div>
<div id="calendar-task-modal" class="fixed inset-0 bg-black/40 dark:bg-black/60 z-50 flex justify-center items-end hidden modal-bg-in"><div class="modal-content w-full max-w-md bg-surface-light dark:bg-surface-dark rounded-t-2xl p-4 max-h-[80vh] flex flex-col"><div class="w-10 h-1.5 bg-slate-300 dark:bg-slate-600 rounded-full mx-auto mb-4 flex-shrink-0"></div><h3 id="calendar-modal-title" class="text-lg font-bold text-center mb-4 flex-shrink-0"></h3><div id="calendar-modal-tasks" class="space-y-3 overflow-y-auto"></div></div></div>


<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DOM ELEMENTLERİ ---
        const mainContent = document.getElementById('main-content');
        const headerTitle = document.getElementById('header-title');
        const fab = document.getElementById('fab');
        const navItems = document.querySelectorAll('.nav-item');
        const addTaskModal = document.getElementById('add-task-modal');
        const filterModal = document.getElementById('filter-modal');
        const calendarTaskModal = document.getElementById('calendar-task-modal');
        const searchBtn = document.getElementById('search-btn');
        const searchInput = document.getElementById('search-input');
        const imagePreview = document.getElementById('image-preview');
        const imageInput = document.getElementById('task-image-input');
        
        // --- LOCALSTORAGE & STATE ---
        const defaultTasks = [];
        let tasks = JSON.parse(localStorage.getItem('tasks')) || defaultTasks;
        let userSettings = JSON.parse(localStorage.getItem('userSettings')) || {
            username: 'Kullanıcı',
            notificationsEnabled: false,
            profilePicture: 'https://i.pravatar.cc/100',
            theme: 'light'
        };
        
        // **DÜZELTME:** UYGULAMA AÇILIRKEN TEMAYI YÜKLE
        if (userSettings.theme === 'dark') {
            document.documentElement.classList.add('dark');
        }

        const saveTasks = () => localStorage.setItem('tasks', JSON.stringify(tasks));
        const saveUserSettings = () => localStorage.setItem('userSettings', JSON.stringify(userSettings));

        const alarmSound = new Audio('https://cdn.pixabay.com/download/audio/2024/03/04/audio_d740ca5e97.mp3');

        let currentFilter = 'all';
        let currentSearchTerm = '';
        let currentPage = 'home';
        let calendarDate = new Date();

        const monthNames = ["Ocak", "Şubat", "Mart", "Nisan", "Mayıs", "Haziran", "Temmuz", "Ağustos", "Eylül", "Ekim", "Kasım", "Aralık"];

        // --- RENDER FONKSİYONLARI ---
        const renderTasks = () => {
            if (currentPage !== 'home') return;
            const todayStr = new Date().toISOString().slice(0, 10);
            let tasksToRender = tasks.filter(task => task.date === todayStr);
            if (currentFilter === 'active') tasksToRender = tasksToRender.filter(task => !task.completed);
            else if (currentFilter === 'completed') tasksToRender = tasksToRender.filter(task => task.completed);
            if (currentSearchTerm) tasksToRender = tasksToRender.filter(task => task.title.toLowerCase().includes(currentSearchTerm.toLowerCase()));
            
            mainContent.innerHTML = '';
            if (tasksToRender.length === 0) {
                 mainContent.innerHTML = `<div class="text-center py-10 text-slate-500 dark:text-slate-400"><i class="fa-solid fa-clipboard-check text-4xl mb-3"></i><p>Bugün için görev yok.</p></div>`; return;
            }
            tasksToRender.forEach(task => mainContent.insertAdjacentHTML('beforeend', createTaskCardHTML(task)));
        };

        const createTaskCardHTML = (task) => {
            const priorityClasses = { high: 'border-red-500', medium: 'border-yellow-500', low: 'border-blue-500' };
            // **DÜZELTME:** Açıklama metnini ve ikonları ayarla
            const descriptionHTML = task.description ? `<p class="text-sm text-slate-500 dark:text-slate-400 truncate">${task.description}</p>` : '';
            const imageIcon = task.image ? `<i class="fa-solid fa-image text-xs"></i>` : '';
            const alarmIcon = task.alarmTime ? `<i class="fa-solid fa-bell text-xs"></i>` : '';
            
            return `
            <div class="bg-surface-light dark:bg-slate-800 p-4 rounded-2xl soft-shadow dark:soft-shadow-dark flex items-center space-x-4 border-l-4 ${priorityClasses[task.priority]} animate-fade-in mb-3" data-task-id="${task.id}">
                <input type="checkbox" class="task-checkbox w-6 h-6 rounded-md border-2 border-slate-300 dark:border-slate-600 accent-primary-light dark:accent-primary-dark flex-shrink-0" ${task.completed ? 'checked' : ''}>
                <div class="flex-1 min-w-0">
                    <p class="font-medium truncate ${task.completed ? 'line-through text-slate-400 dark:text-slate-500' : ''}">${task.title}</p>
                    ${descriptionHTML}
                    <div class="flex items-center space-x-2 text-slate-400 mt-1">${imageIcon}${alarmIcon}</div>
                </div>
                <button class="delete-task-btn text-slate-400 hover:text-red-500 dark:hover:text-red-500 smooth-transition p-2"><i class="fa-solid fa-trash"></i></button>
            </div>`;
        };

        const renderCalendar = () => { /* Değişiklik yok */ };

        const pages = {
            settings: `<div class="space-y-6 animate-fade-in">
                <div class="flex flex-col items-center space-y-3 p-6 bg-surface-light dark:bg-slate-800 rounded-2xl soft-shadow dark:soft-shadow-dark">
                    <label for="avatar-upload-input" class="avatar-upload-label">
                        <img id="avatar-image" src="" alt="Avatar" class="w-24 h-24 rounded-full border-4 border-primary-light dark:border-primary-dark object-cover">
                        <div class="overlay"><i class="fa-solid fa-camera"></i></div>
                    </label>
                    <input type="file" id="avatar-upload-input" class="hidden" accept="image/*">
                    <input type="text" id="username-input" class="text-2xl font-bold bg-transparent text-center focus:outline-none focus:bg-slate-100 dark:focus:bg-slate-700 rounded-lg px-2 py-1 w-full max-w-[200px]" value="Kullanıcı">
                </div>
                <div class="bg-surface-light dark:bg-slate-800 rounded-2xl soft-shadow dark:soft-shadow-dark divide-y divide-slate-200 dark:divide-slate-700">
                    <div class="p-4 flex justify-between items-center">
                        <div class="flex items-center space-x-4"><i class="fa-solid fa-palette text-slate-500 dark:text-slate-400 w-5 text-center"></i><span>Koyu Mod</span></div>
                        <button id="theme-toggle" class="relative inline-flex items-center h-6 rounded-full w-11 transition-colors bg-slate-200 dark:bg-slate-600">
                            <span id="theme-toggle-dot" class="inline-block w-4 h-4 transform bg-white rounded-full transition-transform"></span>
                        </button>
                    </div>
                    <div class="p-4 flex justify-between items-center">
                        <div class="flex items-center space-x-4"><i class="fa-solid fa-bell text-slate-500 dark:text-slate-400 w-5 text-center"></i><span>Bildirimler</span></div>
                        <button id="notification-toggle" class="relative inline-flex items-center h-6 rounded-full w-11 transition-colors bg-slate-200 dark:bg-slate-600">
                            <span id="notification-toggle-dot" class="inline-block w-4 h-4 transform bg-white rounded-full transition-transform"></span>
                        </button>
                    </div>
                </div>
            </div>`
        };

        // --- OLAY DİNLEYİCİLERİ ---
        const navigateTo = (page) => {
            currentPage = page;
            mainContent.innerHTML = pages[page] || '';
            headerTitle.textContent = { home: 'Bugün', calendar: 'Takvim', settings: 'Ayarlar' }[page];
            fab.classList.toggle('hidden', page !== 'home');
            fab.classList.toggle('flex', page === 'home');
            document.getElementById('header-icons').classList.toggle('hidden', page !== 'home');
            navItems.forEach(item => {
                const isActive = item.dataset.page === page;
                item.classList.toggle('text-primary-light', isActive);
                item.classList.toggle('dark:text-primary-dark', isActive);
                item.classList.toggle('text-slate-500', !isActive);
                item.classList.toggle('dark:text-slate-400', !isActive);
            });
            
            if (page === 'home') {
                renderTasks();
            } else if (page === 'calendar') {
                renderCalendar();
            } else if (page === 'settings') {
                // **DÜZELTME:** Tema değiştirici artık durumu kaydediyor
                const themeToggle = document.getElementById('theme-toggle');
                const themeToggleDot = document.getElementById('theme-toggle-dot');

                const updateThemeToggleVisuals = () => {
                    if (document.documentElement.classList.contains('dark')) {
                        themeToggle.classList.add('bg-primary-dark');
                        themeToggleDot.classList.add('translate-x-5');
                    } else {
                        themeToggle.classList.remove('bg-primary-dark');
                        themeToggleDot.classList.remove('translate-x-5');
                    }
                };

                themeToggle.addEventListener('click', () => {
                    document.documentElement.classList.toggle('dark');
                    userSettings.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
                    saveUserSettings();
                    updateThemeToggleVisuals();
                });
                updateThemeToggleVisuals();
                
                // Kullanıcı Adı
                const usernameInput = document.getElementById('username-input');
                usernameInput.value = userSettings.username;
                usernameInput.addEventListener('blur', () => {
                    const newName = usernameInput.value.trim();
                    if (newName) { userSettings.username = newName; saveUserSettings(); } 
                    usernameInput.value = userSettings.username;
                });

                // Profil Fotoğrafı
                const avatarImage = document.getElementById('avatar-image');
                avatarImage.src = userSettings.profilePicture;
                document.getElementById('avatar-upload-input').addEventListener('change', (event) => {
                    const file = event.target.files[0];
                    if (!file) return;
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const imageDataUrl = e.target.result;
                        avatarImage.src = imageDataUrl;
                        userSettings.profilePicture = imageDataUrl;
                        saveUserSettings();
                    };
                    reader.readAsDataURL(file);
                });

                // Bildirimler
                const notificationToggle = document.getElementById('notification-toggle');
                const notificationToggleDot = document.getElementById('notification-toggle-dot');
                
                const updateNotificationToggleVisuals = () => {
                    notificationToggle.classList.remove('bg-primary-light', 'dark:bg-primary-dark', 'bg-slate-200', 'dark:bg-slate-600');
                    notificationToggleDot.classList.remove('translate-x-5');
                    if (userSettings.notificationsEnabled) {
                        notificationToggle.classList.add('bg-primary-light', 'dark:bg-primary-dark');
                        notificationToggleDot.classList.add('translate-x-5');
                    } else {
                        notificationToggle.classList.add('bg-slate-200', 'dark:bg-slate-600');
                    }
                };
                notificationToggle.addEventListener('click', () => {
                    const intendedState = !userSettings.notificationsEnabled;
                    if (intendedState && Notification.permission !== 'granted') {
                        Notification.requestPermission().then(permission => {
                            if (permission === 'granted') {
                                userSettings.notificationsEnabled = true;
                                saveUserSettings();
                                updateNotificationToggleVisuals();
                            }
                        });
                    } else {
                        userSettings.notificationsEnabled = intendedState;
                        saveUserSettings();
                        updateNotificationToggleVisuals();
                    }
                });
                updateNotificationToggleVisuals();
            }
        };

        navItems.forEach(item => item.addEventListener('click', () => navigateTo(item.dataset.page)));
        
        const openModal = (modal) => modal.classList.remove('hidden');
        const closeModal = (modal) => {
            const modalContent = modal.querySelector('.modal-content');
            modal.classList.add('modal-bg-out');
            if (modalContent) modalContent.classList.add('modal-content-out');
            setTimeout(() => {
                modal.classList.add('hidden');
                modal.classList.remove('modal-bg-out');
                if (modalContent) modalContent.classList.remove('modal-content-out');
            }, 300);
        };
        [addTaskModal, filterModal, calendarTaskModal].forEach(modal => modal.addEventListener('click', (e) => { if (e.target === modal || e.target.closest('.cancel-btn')) closeModal(modal); }));

        fab.addEventListener('click', () => { 
            const form = document.getElementById('add-task-form');
            form.reset();
            imagePreview.classList.add('hidden');
            imagePreview.src = '';
            document.getElementById('task-date-input').valueAsDate = new Date(); 
            openModal(addTaskModal); 
        });

        imageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => { imagePreview.src = e.target.result; imagePreview.classList.remove('hidden'); };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('add-task-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const title = document.getElementById('task-title-input').value;
            const description = document.getElementById('task-description-input').value;
            const date = document.getElementById('task-date-input').value;
            const alarmTime = document.getElementById('task-time-input').value;
            const priority = document.getElementById('task-priority-input').value;
            const imageFile = imageInput.files[0];

            // **DÜZELTME:** İlk alarmlı görevde bildirim izni iste
            if (alarmTime && Notification.permission === 'default') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        userSettings.notificationsEnabled = true;
                        saveUserSettings();
                    }
                });
            }

            const createTask = (imageData) => {
                if (title.trim() && date) {
                    tasks.unshift({ 
                        id: Date.now(), title: title.trim(), description: description.trim(), priority, date, 
                        alarmTime: alarmTime || null, alarmTriggered: false, completed: false, image: imageData || null 
                    });
                    saveTasks();
                    if (currentPage === 'home') renderTasks();
                    else if (currentPage === 'calendar') renderCalendar();
                    closeModal(addTaskModal);
                }
            };
            if (imageFile) {
                const reader = new FileReader();
                reader.onloadend = () => createTask(reader.result);
                reader.readAsDataURL(imageFile);
            } else { createTask(null); }
        });

        mainContent.addEventListener('click', (e) => { /* Değişiklik Yok */ });
        searchBtn.addEventListener('click', () => { /* Değişiklik Yok */ });
        searchInput.addEventListener('input', (e) => { /* Değişiklik Yok */ });
        document.getElementById('filter-btn').addEventListener('click', () => openModal(filterModal));
        document.querySelectorAll('.filter-option').forEach(option => option.addEventListener('click', (e) => { /* Değişiklik Yok */ }));

        const checkAlarms = () => {
            const now = new Date();
            let stateChanged = false;
            tasks.forEach(task => {
                if (task.completed || !task.alarmTime || task.alarmTriggered) return;
                
                const [hours, minutes] = task.alarmTime.split(':');
                const taskDateTime = new Date(task.date);
                taskDateTime.setHours(hours, minutes, 0, 0);

                if (now >= taskDateTime) {
                    if (userSettings.notificationsEnabled && Notification.permission === 'granted') {
                        new Notification(task.title, { body: 'Bu görevin zamanı geldi!', icon: userSettings.profilePicture });
                    }
                    alarmSound.play().catch(e => console.error("Alarm sesi çalınamadı:", e));
                    task.alarmTriggered = true;
                    stateChanged = true;
                }
            });
            if (stateChanged) saveTasks();
        };

        setInterval(checkAlarms, 30000);
        
        navigateTo('home');
    });
</script>
</body>
</html>

